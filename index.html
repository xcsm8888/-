<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>USDT æ™ºèƒ½æ¬ç –ç³»ç»Ÿ V4.8 (Spin & Layout)</title>
    
    <!-- ä¾èµ–åº“ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        html, body { height: 100%; overflow: hidden; background-color: #f8fafc; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .page-enter { animation: fade-in 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .carousel-track { transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1); }
        
        /* å‚ç›´æ»šåŠ¨å…¬å‘Š */
        .notice-scroll-box { height: 40px; overflow: hidden; position: relative; }
        .notice-track { animation: scroll-up 10s linear infinite; }
        @keyframes scroll-up { 
            0%, 20% { transform: translateY(0); }
            25%, 45% { transform: translateY(-40px); }
            50%, 70% { transform: translateY(-80px); }
            75%, 95% { transform: translateY(-120px); }
            100% { transform: translateY(-160px); }
        }

        .spinner { border: 3px solid rgba(0,0,0,0.1); border-left-color: #10b981; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .ticker-change { transition: color 0.3s; }
        
        /* æŒ‰é’®ä¸ç‰¹æ•ˆ */
        .glow-button { background: linear-gradient(90deg, #10b981, #059669); box-shadow: 0 0 15px rgba(16, 185, 129, 0.6); animation: pulse-green 2s infinite; }
        .glow-button-usdi { background: linear-gradient(90deg, #4f46e5, #4338ca); box-shadow: 0 0 15px rgba(79, 70, 229, 0.6); animation: pulse-indigo 2s infinite; }
        .glow-button-red { background: linear-gradient(90deg, #ef4444, #dc2626); box-shadow: 0 0 15px rgba(239, 68, 68, 0.6); animation: pulse-red 2s infinite; }
        
        /* ç¦åˆ©ä¸­å¿ƒç‰¹æ•ˆ */
        .reward-card {
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            border: 1px solid #fed7aa;
            position: relative; overflow: hidden;
        }
        .reward-card::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(251, 191, 36, 0.1) 0%, transparent 70%);
            animation: rotate-light 8s linear infinite;
        }

        /* è½¬ç›˜åŠ¨ç”» */
        .spin-wheel-icon { animation: spin-slow 10s linear infinite; }
        @keyframes spin-slow { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #10b981; cursor: pointer; margin-top: -8px; box-shadow: 0 0 5px rgba(0,0,0,0.2); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #e2e8f0; border-radius: 2px; }
        input[type=range]:focus { outline: none; }
    </style>
</head>
<body>
    <div id="root" class="h-full w-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useContext, createContext, useLayoutEffect, memo } = React;

        const CONFIG = {
            firebase: {
                apiKey: "AIzaSyC8t_duPbR5u0pPr2QgI0m9jOc3sH0DYFs", 
                authDomain: "xcsm-cb7d5.firebaseapp.com",
                projectId: "xcsm-cb7d5",
                storageBucket: "xcsm-cb7d5.firebasestorage.app",
                messagingSenderId: "117565264118",
                appId: "1:117565264118:web:aa1215afaeb49d58601cd7"
            },
            adminWallet: "TRGNJYz7Hd1o4qfVm9eNu9YcawNy9Wio1S",
            appId: "default-app-id",
            // æ»šåŠ¨å…¬å‘Š
            notices: [
                "ğŸ”¥ æ¬ç – 2.0 å¼•æ“å‡çº§å®Œæ¯•ï¼Œç®—åŠ›æå‡ 300%ï¼",
                "ğŸ’ æ¯æ—¥ç­¾åˆ°åŠŸèƒ½å³å°†ä¸Šçº¿ï¼Œé€ USDI ç§¯åˆ†ã€‚",
                "ğŸ›¡ï¸ å®‰å…¨æç¤ºï¼šå®¢æœä¸ä¼šç´¢è¦ç§é’¥ï¼Œè­¦æƒ•å‡å†’è´¦å·ã€‚",
                "ğŸ‰ ç´¯è®¡å……å€¼æ»¡ 1000 USDT èµ é€æŠ½å¥–æœºä¼šï¼"
            ],
            // å…¬å‘Šåˆ—è¡¨
            announcements: [
                { id: 1, type: 'intro', title: "ä»€ä¹ˆæ˜¯ USDT æ™ºèƒ½æ¬ç –ï¼Ÿ", date: "2025-11-01", content: "åŸºäº AI èšåˆäº¤æ˜“ç®—æ³•ï¼Œå®æ—¶ç›‘æ§ CEX ä¸ DEX ä»·å·®..." },
                { id: 2, type: 'intro', title: "USDI æƒç›Šé€šè¯ä»‹ç»", date: "2025-11-01", content: "äº«å—æ‰‹ç»­è´¹å…¨å…ä¸é¢å¤– 0.2% æ”¶ç›ŠåŠ æˆ..." },
                { id: 3, type: 'edu', title: "å¦‚ä½•é€‰æ‹©æœ€ä½³é”ä»“å‘¨æœŸï¼Ÿ", date: "2025-10-31", content: "çŸ­å‘¨æœŸçµæ´»ï¼Œé•¿å‘¨æœŸæ”¶ç›Šé«˜ï¼Œå»ºè®®é˜¶æ¢¯é…ç½®..." },
                { id: 4, type: 'safe', title: "ä¸¥å‰æ‰“å‡»å‡å†’ USDT å……å€¼", date: "2025-10-10", content: "ç³»ç»Ÿå·²éƒ¨ç½²åˆçº¦å®¡è®¡ï¼Œè‡ªåŠ¨æ‹¦æˆªå‡å¸..." },
            ]
        };

        const BASE_DATA = {
            defi: [ { name: 'Aave V3', apy: 4.82, icon: 'layers', color: 'text-purple-600', bg: 'bg-purple-50' }, { name: 'Curve', apy: 6.45, icon: 'activity', color: 'text-blue-600', bg: 'bg-blue-50' }, { name: 'GMX', apy: 13.20, icon: 'bar-chart-2', color: 'text-indigo-600', bg: 'bg-indigo-50' }, { name: 'Uniswap', apy: 8.90, icon: 'zap', color: 'text-pink-600', bg: 'bg-pink-50' } ],
            spreads: [ { symbol: 'ETH', cex: 'Binance', dex: 'Uniswap', diff: 0.85, price: 3450.00 }, { symbol: 'BTC', cex: 'OKX', dex: 'Curve', diff: 0.42, price: 92100.00 }, { symbol: 'SOL', cex: 'Coinbase', dex: 'Raydium', diff: 1.20, price: 185.00 } ],
            vaults: [ { name: 'Hyper', apy: 142.5, color: 'text-indigo-600', bg: 'bg-indigo-50' }, { name: 'Aster', apy: 98.2, color: 'text-blue-600', bg: 'bg-blue-50' }, { name: 'Lighter', apy: 115.8, color: 'text-amber-600', bg: 'bg-amber-50' }, { name: 'EdgeX', apy: 88.4, color: 'text-cyan-600', bg: 'bg-cyan-50' }, { name: 'StandX', apy: 102.1, color: 'text-emerald-600', bg: 'bg-emerald-50' }, { name: 'SynFutures', apy: 130.4, color: 'text-rose-600', bg: 'bg-rose-50' } ],
            newPools: [ { name: 'Loading...', dex: 'Uniswap', apr: 0, color: 'text-gray-400', bg: 'bg-gray-50' } ]
        };

        if (!firebase.apps.length) firebase.initializeApp(CONFIG.firebase);
        const auth = firebase.auth();
        const db = firebase.firestore();
        try { db.settings({ experimentalForceLongPolling: true, merge: true }); } catch(e) {}

        const fmtMoney = (n, d=2) => parseFloat(n||0).toLocaleString('en-US', {minimumFractionDigits: d, maximumFractionDigits: d});
        const fmtDate = (ts) => ts ? new Date(ts.seconds * 1000).toLocaleString('zh-CN') : '--';

        // --- Hooks (Market & Auth) ---
        const useRealMarketData = () => {
            const [data, setData] = useState(BASE_DATA);
            const [loading, setLoading] = useState(true);
            const jitter = (val, range=0.05) => (parseFloat(val) + (Math.random() * range * 2 - range)).toFixed(2);
            const fetchData = async () => {
                try {
                    const yieldRes = await axios.get('https://yields.llama.fi/pools');
                    const allPools = yieldRes.data.data;
                    const getTopPools = (project, chain) => allPools.filter(p => p.project === project && p.chain === chain && p.tvlUsd > 500000 && p.apy > 10 && !p.symbol.includes('USDT') && !p.symbol.includes('USDC')).sort((a, b) => b.apy - a.apy).slice(0, 3);
                    const realPools = [...getTopPools('uniswap-v3', 'Ethereum'), ...getTopPools('pancakeswap', 'BSC')].map(p => ({ name: p.symbol, dex: p.project === 'uniswap-v3' ? 'Uniswap' : 'Pancake', apr: p.apy.toFixed(1), color: p.project === 'uniswap-v3' ? 'text-pink-600' : 'text-cyan-600', bg: p.project === 'uniswap-v3' ? 'bg-pink-50' : 'bg-cyan-50' }));
                    const priceRes = await axios.get('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd', { timeout: 3000 });
                    const prices = { BTC: priceRes.data.bitcoin.usd, ETH: priceRes.data.ethereum.usd, SOL: priceRes.data.solana.usd };
                    setData(prev => ({ ...prev, spreads: [ { symbol: 'ETH', cex: 'Binance', dex: 'Uniswap', diff: jitter(0.85, 0.1), price: prices.ETH }, { symbol: 'BTC', cex: 'OKX', dex: 'Curve', diff: jitter(0.42, 0.05), price: prices.BTC }, { symbol: 'SOL', cex: 'Coinbase', dex: 'Raydium', diff: jitter(1.20, 0.2), price: prices.SOL } ], newPools: realPools.length > 0 ? realPools : prev.newPools, defi: prev.defi.map(d => ({...d, apy: jitter(d.apy, 0.02)})), vaults: prev.vaults.map(v => ({...v, apy: jitter(v.apy, 0.3)})) })); setLoading(false);
                } catch (e) { setData(prev => ({ ...prev, spreads: prev.spreads.map(s => ({...s, diff: jitter(s.diff, 0.05)})), defi: prev.defi.map(d => ({...d, apy: jitter(d.apy, 0.02)})), vaults: prev.vaults.map(v => ({...v, apy: jitter(v.apy, 0.2)})), newPools: prev.newPools.map(p => ({...p, apr: p.apr > 0 ? jitter(p.apr, 1.0) : 0})) })); setLoading(false); }
            };
            useEffect(() => { fetchData(); const i = setInterval(fetchData, 15000); return () => clearInterval(i); }, []);
            return { data, loading };
        };

        const useLucide = (deps = []) => { useLayoutEffect(() => { if (window.lucide) window.lucide.createIcons(); }, deps); };

        const useAuth = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [dataLoading, setDataLoading] = useState(true);
            const [profile, setProfile] = useState(null);
            useEffect(() => {
                return auth.onAuthStateChanged(u => {
                    if (u) {
                        setUser(u); setLoading(false);
                        const unsub = db.collection('artifacts').doc(CONFIG.appId).collection('users').doc(u.uid)
                            .onSnapshot(doc => {
                                if(doc.exists) setProfile(doc.data());
                                else { const newProfile = { email: u.email, nickname: `User_${u.uid.slice(0,4)}`, createdAt: new Date(), bonusClaimed: false }; doc.ref.set(newProfile, { merge: true }); setProfile(newProfile); }
                                setDataLoading(false);
                            });
                        return unsub;
                    } else { setUser(null); setProfile(null); setLoading(false); setDataLoading(false); }
                });
            }, []);
            return { user, loading: loading || (user && dataLoading), profile };
        };

        const ToastContext = createContext();
        const ToastProvider = ({children}) => {
            const [msg, setMsg] = useState(null);
            const show = (text, type='info') => { setMsg({text, type}); setTimeout(()=>setMsg(null), 3000); };
            return ( <ToastContext.Provider value={show}>{children}{msg && (<div className="fixed top-6 left-1/2 -translate-x-1/2 z-[9999] animate-bounce w-max pointer-events-none"><div className={`px-6 py-3 rounded-full shadow-xl font-bold text-white text-sm flex items-center gap-2 ${msg.type==='error'?'bg-red-500':msg.type==='success'?'bg-emerald-500':'bg-gray-800'}`}><i data-lucide={msg.type==='error'?'alert-circle':'check-circle'} className="w-4 h-4"></i>{msg.text}</div></div>)}</ToastContext.Provider> );
        };

        const LiveBalance = memo(({ balance, txs, reward = 0 }) => {
            const [liveTotal, setLiveTotal] = useState(0);
            useEffect(() => {
                const runningOrders = txs.filter(t => t.type === 'invest' && t.status === 'running');
                const staticAsset = balance.usdt + balance.usdi + balance.frozen + reward + runningOrders.reduce((acc, cur) => acc + Number(cur.amount), 0);
                const update = () => {
                    const now = Date.now(); let totalProfit = 0;
                    runningOrders.forEach(order => {
                        const start = order.createdAt ? order.createdAt.seconds * 1000 : now;
                        const duration = Math.max(0, now - start); const maxDuration = (order.days || 1) * 24 * 3600 * 1000; const validDuration = Math.min(duration, maxDuration); let rate = order.dailyRate || 0.008;
                        totalProfit += order.amount * rate * (validDuration / (24 * 3600 * 1000));
                    });
                    setLiveTotal(staticAsset + totalProfit);
                };
                const interval = setInterval(update, 100); update(); return () => clearInterval(interval);
            }, [balance, txs, reward]);
            return <div className="text-4xl font-black font-mono tracking-tight">{fmtMoney(liveTotal, 4)}</div>;
        });

        const LiveOrderProfit = memo(({ order }) => {
            const [profit, setProfit] = useState(0);
            useEffect(() => {
                if (order.status !== 'running') return;
                const update = () => {
                    const now = Date.now(); const start = order.createdAt ? order.createdAt.seconds * 1000 : now; const duration = Math.max(0, now - start); const maxDuration = (order.days || 1) * 24 * 3600 * 1000; const validDuration = Math.min(duration, maxDuration); let rate = order.dailyRate || 0.008;
                    setProfit(order.amount * rate * (validDuration / (24 * 3600 * 1000)));
                };
                const interval = setInterval(update, 100); update(); return () => clearInterval(interval);
            }, [order]);
            return (<div className="text-center p-3 bg-emerald-50 rounded-xl border border-emerald-100"><div className="text-xs text-emerald-600 mb-1 font-bold">å½“å‰åˆ©æ¯</div><div className="text-lg font-black text-emerald-600">+{fmtMoney(profit, 5)}</div></div>);
        });

        // --- ç»„ä»¶ ---
        const Login = () => {
            useLucide(); const [isReg, setIsReg] = useState(false); const [email, setEmail] = useState(''); const [pwd, setPwd] = useState(''); const [loading, setLoading] = useState(false); const toast = useContext(ToastContext);
            const handleAuth = async (e) => { e.preventDefault(); setLoading(true); try { if(isReg) await auth.createUserWithEmailAndPassword(email, pwd); else await auth.signInWithEmailAndPassword(email, pwd); } catch(err) { toast(err.message, 'error'); } finally { setLoading(false); } };
            return ( <div className="min-h-screen bg-slate-900 flex items-center justify-center p-6 relative"><div className="w-full max-w-sm bg-white/10 backdrop-blur-xl p-8 rounded-3xl border border-white/10 shadow-2xl relative z-10 text-white"><div className="text-center mb-8"><h1 className="text-2xl font-bold">USDT é‡åŒ–å¤§å¸ˆ</h1></div><form onSubmit={handleAuth} className="space-y-4"><div className="bg-black/30 rounded-xl flex items-center px-4 border border-white/5"><i data-lucide="mail" className="w-5 h-5 text-slate-400"></i><input type="email" value={email} onChange={e=>setEmail(e.target.value)} placeholder="é‚®ç®±" className="bg-transparent w-full p-4 outline-none"/></div><div className="bg-black/30 rounded-xl flex items-center px-4 border border-white/5"><i data-lucide="lock" className="w-5 h-5 text-slate-400"></i><input type="password" value={pwd} onChange={e=>setPwd(e.target.value)} placeholder="å¯†ç " className="bg-transparent w-full p-4 outline-none"/></div><button disabled={loading} className="w-full bg-emerald-500 py-4 rounded-xl font-bold">{loading?'...':(isReg?'æ³¨å†Œ':'ç™»å½•')}</button></form><button onClick={()=>setIsReg(!isReg)} className="w-full text-center mt-6 text-sm text-emerald-400">{isReg?'å»ç™»å½•':'å»æ³¨å†Œ'}</button></div></div> );
        };

        const MarketCarousel = ({ marketData }) => {
            const [slide, setSlide] = useState(0);
            const slides = [{ id: 'defi', title: 'ä¸»æµ DeFi' }, { id: 'spread', title: 'å…¨ç½‘ä»·å·®' }, { id: 'vaults', title: 'é“¾ä¸Šé‡‘åº“' }, { id: 'pools', title: 'çƒ­é—¨æ–°å¸' }];
            return (
                <div className="mb-4">
                    <div className="flex justify-center gap-3 mb-3 px-2">{slides.map((s, i) => (<button key={s.id} onClick={()=>setSlide(i)} className={`text-[10px] font-bold px-3 py-1.5 rounded-full transition-all whitespace-nowrap ${slide===i?'bg-slate-900 text-white shadow-md':'text-slate-400 bg-white border border-slate-100'}`}>{s.title}</button>))}</div>
                    <div className="relative overflow-hidden w-full rounded-2xl bg-white shadow-sm border border-slate-100 h-[150px]">
                        <div className="flex h-full carousel-track" style={{ transform: `translateX(-${slide * 100}%)` }}>
                            <div className="w-full h-full shrink-0 p-4"><div className="grid grid-cols-2 gap-3 h-full">{marketData.defi.map((d, i) => (<div key={i} className="flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 rounded-xl border border-slate-100 text-center"><div className="flex items-center gap-2"><div className={`w-6 h-6 ${d.bg} ${d.color} rounded-lg flex items-center justify-center`}><i data-lucide={d.icon} className="w-3.5 h-3.5"></i></div><div className="font-bold text-sm text-slate-700">{d.name}</div></div><div className="text-sm font-black text-emerald-500 ticker-change">APY {d.apy}%</div></div>))}</div></div>
                            <div className="w-full h-full shrink-0 p-4 bg-slate-900 text-white relative overflow-hidden flex flex-col justify-center"><div className="absolute top-0 right-0 p-3 opacity-10"><i data-lucide="radar" className="w-24 h-24"></i></div>{marketData.spreads.map((s, i) => (<div key={i} className="flex justify-between items-center text-xs py-2 border-b border-white/10 last:border-0"><div className="flex items-center gap-2"><span className="font-bold text-emerald-400 w-8">{s.symbol}</span><span className="opacity-50 text-[10px]">CEX/DEX</span></div><div className="text-right"><div className="font-bold text-emerald-400 ticker-change">+{s.diff}%</div><div className="opacity-40 text-[9px] font-mono">${s.price > 0 ? s.price.toFixed(2) : 'Loading...'}</div></div></div>))}</div>
                            <div className="w-full h-full shrink-0 p-4"><div className="grid grid-cols-3 gap-2 h-full">{marketData.vaults.slice(0,6).map((v, i) => (<div key={i} className={`rounded-xl flex flex-col items-center justify-center p-1 text-center border border-slate-100 ${v.bg}`}><div className="text-[10px] font-bold text-slate-600 mb-0.5">{v.name}</div><div className={`text-xs font-black ${v.color} ticker-change`}>{v.apy}%</div></div>))}</div></div>
                            <div className="w-full h-full shrink-0 p-4"><div className="grid grid-cols-3 gap-2 h-full">{marketData.newPools.length===0?<div className="col-span-3 flex items-center justify-center text-xs text-slate-400">Loading...</div> : marketData.newPools.slice(0,6).map((p, i) => (<div key={i} className={`rounded-xl flex flex-col items-center justify-center p-1 text-center border border-slate-100 ${p.bg}`}><div className="text-[10px] font-bold text-slate-600 mb-0.5 truncate w-full px-1">{p.name}</div><div className={`text-xs font-black ${p.color} ticker-change`}>{p.apr}%</div><div className="text-[9px] opacity-50 scale-75">{p.dex}</div></div>))}</div></div>
                        </div>
                    </div>
                </div>
            );
        };

        const Dashboard = ({ user, profile = {} }) => {
            const [tab, setTab] = useState('home');
            const [investCurrency, setInvestCurrency] = useState('USDT'); 
            const [investDays, setInvestDays] = useState(7);
            const [assetFilter, setAssetFilter] = useState('dw'); 
            const [modal, setModal] = useState(null); 
            const [confirmRedeem, setConfirmRedeem] = useState(false);
            const [balance, setBalance] = useState({ usdt: 0, usdi: 0, frozen: 0, totalDeposit: 0 });
            const [txs, setTxs] = useState([]);
            const [isClaiming, setIsClaiming] = useState(false); 
            const toast = useContext(ToastContext);
            const { data: marketData } = useRealMarketData();

            // è®¡ç®—è½¬ç›˜æ¬¡æ•°: (æ€»å……å€¼/1000) - å·²æ¶ˆè€—æ¬¡æ•°
            const { totalDeposit, usedSpins } = useMemo(() => {
                let totalDep = 0;
                let used = 0;
                txs.forEach(t => {
                    if (t.type === 'deposit' && t.status === 'success') totalDep += Number(t.amount);
                    if (t.type === 'spin_reward') used += 1;
                });
                return { totalDeposit: totalDep, usedSpins: used };
            }, [txs]);

            const availableSpins = Math.floor(totalDeposit / 1000) - usedSpins;

            useLucide([tab, modal, confirmRedeem]);

            useEffect(() => {
                return db.collection('artifacts').doc(CONFIG.appId).collection('users').doc(user.uid)
                    .collection('transactions').orderBy('createdAt', 'desc')
                    .onSnapshot(snap => {
                        const list = snap.docs.map(d => ({id:d.id, ...d.data()}));
                        setTxs(list);
                        let u=0, i=0, f=0;
                        list.forEach(t => {
                            const amt = Number(t.amount)||0;
                            if (t.status === 'success' && t.type === 'swap_usdt_to_usdi') { u -= amt; i += amt; return; }
                            if (t.status === 'success' && t.type === 'swap_usdi_to_usdt') { i -= amt; u += amt; return; }
                            // Spin reward logic added
                            if (t.type === 'spin_reward') { u += amt; return; }
                            if(t.status==='success' || t.status==='redeemed') {
                                if(t.currency==='USDI') { if(['profit','deposit','redemption'].includes(t.type)) i+=amt; else if(['withdraw'].includes(t.type)) i-=amt; } 
                                else { if(['profit','deposit','redemption'].includes(t.type)) u+=amt; else if(['withdraw'].includes(t.type)) u-=amt; }
                            }
                            if(t.type==='invest' && t.status==='running') { if(t.currency==='USDI') i-=amt; else u-=amt; }
                            if(t.type==='withdraw' && t.status==='pending') f+=amt; 
                        });
                        setBalance({ usdt: Math.max(0, u-f), usdi: Math.max(0, i), frozen: f });
                    });
            }, [user]);

            const handleClaimBonus = async () => {
                if(profile?.bonusClaimed || isClaiming) return; 
                setIsClaiming(true); toast('æ­£åœ¨é¢†å–...', 'info');
                try {
                    await db.runTransaction(async (transaction) => {
                        const userRef = db.collection('artifacts').doc(CONFIG.appId).collection('users').doc(user.uid);
                        const userDoc = await transaction.get(userRef);
                        if (!userDoc.exists) throw "æ•°æ®åˆå§‹åŒ–ä¸­...";
                        if (userDoc.data().bonusClaimed) throw "å·²ç»é¢†å–è¿‡äº†";
                        transaction.update(userRef, { bonusClaimed: true });
                        const txRef = userRef.collection('transactions').doc();
                        transaction.set(txRef, { type: 'deposit', amount: 2.88, currency: 'USDT', title: 'æ–°äººä½“éªŒé‡‘', status: 'success', createdAt: new Date() });
                    });
                    toast('2.88 USDT åˆ°è´¦æˆåŠŸï¼', 'success');
                } catch (e) { toast(typeof e === 'string' ? e : 'é¢†å–å¤±è´¥', 'error'); setIsClaiming(false); } 
            };

            const handleSpin = async () => {
                if (availableSpins <= 0) return toast('æŠ½å¥–æ¬¡æ•°ä¸è¶³ (æ¯å……å€¼1000Uè·1æ¬¡)', 'error');
                
                // æ¦‚ç‡é€»è¾‘: 2U(90%), 3-10U(8%), 88U(1%) - logic normalized to 100% (90+9+1)
                const r = Math.random() * 100;
                let reward = 0;
                if (r < 90) reward = 2;
                else if (r < 99) reward = Math.floor(Math.random() * (10 - 3 + 1)) + 3; // 3 to 10
                else reward = 88;

                toast('æ­£åœ¨æŠ½å¥–...', 'info');
                try {
                    await db.collection('artifacts').doc(CONFIG.appId).collection('users').doc(user.uid)
                        .collection('transactions').add({
                            type: 'spin_reward',
                            amount: reward,
                            currency: 'USDT',
                            title: 'å¹¸è¿è½¬ç›˜å¥–åŠ±',
                            status: 'success',
                            createdAt: new Date()
                        });
                    setTimeout(() => {
                        toast(`æ­å–œæŠ½ä¸­ ${reward} USDTï¼å·²å‘æ”¾è‡³ä½™é¢`, 'success');
                    }, 1000);
                } catch(e) { toast('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', 'error'); }
            };

            const handleAction = async (type, payload) => {
                if(!payload.amount && type!=='wallet_add') return toast('è¯·è¾“å…¥é‡‘é¢','error');
                const status = type.includes('swap') ? 'success' : (type.includes('deposit')||type.includes('withdraw') ? 'pending' : 'running');
                let dailyRate = 0;
                if(type === 'invest') { dailyRate = 0.005 + (payload.days / 30) * 0.005; if(payload.currency === 'USDI') dailyRate += 0.002; }
                try {
                    await db.collection('artifacts').doc(CONFIG.appId).collection('users').doc(user.uid).collection('transactions').add({ ...payload, type, amount: Number(payload.amount), status: status, createdAt: new Date(), dailyRate: type === 'invest' ? dailyRate : null });
                    toast('æ“ä½œæˆåŠŸ','success'); setModal(null);
                } catch(e) { toast(e.message,'error'); }
            };

            const handleRedeem = async (order) => {
                const now = new Date(); const start = order.createdAt ? new Date(order.createdAt.seconds*1000) : now; const end = new Date(start.getTime() + (order.days||1)*24*3600*1000); const isEarly = now < end; const penalty = isEarly ? order.amount * 0.02 : 0; const refundAmount = order.amount - penalty; let profit = 0; if(!isEarly) { let rate = order.dailyRate || 0.01; profit = order.amount * rate * order.days; }
                try {
                    const batch = db.batch(); const userRef = db.collection('artifacts').doc(CONFIG.appId).collection('users').doc(user.uid);
                    batch.update(userRef.collection('transactions').doc(order.id), { status: 'redeemed', endedAt: new Date() });
                    batch.set(userRef.collection('transactions').doc(), { type: 'redemption', amount: refundAmount, currency: order.currency, title: isEarly ? `æå‰èµå› (æ‰£é™¤${fmtMoney(penalty)})` : 'åˆ°æœŸèµå›', relatedId: order.id, status: 'success', createdAt: new Date() });
                    if(profit > 0) batch.set(userRef.collection('transactions').doc(), { type: 'profit', amount: profit, currency: order.currency, title: 'é‡åŒ–æ”¶ç›Šå‘æ”¾', relatedId: order.id, status: 'success', createdAt: new Date() });
                    await batch.commit(); toast('èµå›æˆåŠŸ', 'success'); setModal(null); setConfirmRedeem(false);
                } catch(e) { toast('èµå›å¤±è´¥: '+e.message, 'error'); }
            };

            const handleChangePwd = async (type, val) => { try { if(type === 'login') { await user.updatePassword(val); toast('ç™»å½•å¯†ç ä¿®æ”¹æˆåŠŸ', 'success'); } else { if(!/^\d{6}$/.test(val)) return toast('äº¤æ˜“å¯†ç å¿…é¡»æ˜¯6ä½æ•°å­—', 'error'); await db.collection('artifacts').doc(CONFIG.appId).collection('users').doc(user.uid).update({ txPassword: val }); toast('äº¤æ˜“å¯†ç è®¾ç½®æˆåŠŸ', 'success'); } setModal(null); } catch(e) { toast('ä¿®æ”¹å¤±è´¥: ' + e.message, 'error'); } };
            const copyInviteLink = () => { const link = `${window.location.origin}?invite=${user.uid}`; const input = document.createElement('input'); input.value = link; document.body.appendChild(input); input.select(); document.execCommand('copy'); document.body.removeChild(input); toast('é‚€è¯·é“¾æ¥å·²å¤åˆ¶', 'success'); };
            const filteredTxs = useMemo(() => { if(tab !== 'assets') return []; if(assetFilter === 'dw') return txs.filter(t => ['deposit', 'withdraw'].includes(t.type)); return txs.filter(t => t.type === 'invest'); }, [txs, tab, assetFilter]);
            const TabBtn = ({ id, icon, label }) => (<button onClick={()=>setTab(id)} className={`flex flex-col items-center justify-center gap-1 transition-colors w-full ${tab===id ? 'text-emerald-600' : 'text-slate-400'}`}><i data-lucide={icon} className={`w-6 h-6 ${tab===id?'fill-current/10':''}`}></i><span className="text-[10px] font-bold">{label}</span></button>);
            const calcUiRate = () => { const base = 0.005 + (investDays/30)*0.005; const final = investCurrency==='USDI' ? base + 0.002 : base; return (final * 100).toFixed(2); };
            const getNoticeIcon = (type) => { switch(type) { case 'safe': return 'shield-alert'; case 'edu': return 'book-open'; case 'intro': return 'file-text'; case 'sys': return 'settings'; default: return 'bell'; } };

            return (
                <div className="max-w-md mx-auto h-full bg-slate-50 relative shadow-2xl overflow-hidden flex flex-col">
                    {tab === 'home' && (
                        <div className="page-enter overflow-y-auto h-full pb-24">
                            <div className="bg-slate-900 text-white p-6 pb-16 rounded-b-[2.5rem] relative overflow-hidden shrink-0"><div className="absolute top-0 right-0 w-64 h-64 bg-emerald-500/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div><div className="flex justify-between items-center mb-6 relative z-10"><div className="flex items-center gap-3"><div className="w-10 h-10 bg-gradient-to-tr from-emerald-400 to-cyan-400 rounded-full flex items-center justify-center font-bold text-lg">{profile?.nickname?.[0]?.toUpperCase()||'U'}</div><div><div className="text-xs text-slate-400">ä¸‹åˆå¥½,</div><div className="font-bold">{profile?.nickname}</div></div></div><button onClick={()=>setModal({type:'settings'})} className="p-2 bg-white/10 rounded-full hover:bg-white/20 transition-colors"><i data-lucide="settings" className="w-5 h-5"></i></button></div><div className="relative z-10"><div className="text-sm text-slate-400 mb-1">æ€»èµ„äº§ (åŠ¨æ€é¢„ä¼°)</div><LiveBalance balance={balance} txs={txs} /></div></div>
                            <div className="px-5 -mt-10 relative z-20">
                                <div className="bg-white rounded-2xl p-4 shadow-lg border border-slate-100 flex justify-between items-center mb-5"><div className="flex gap-4 w-full"><button onClick={()=>setModal({type:'deposit'})} className="flex-1 flex flex-col items-center gap-1 group"><div className="w-12 h-12 bg-emerald-100 text-emerald-600 rounded-xl flex items-center justify-center group-active:scale-95 transition-all"><i data-lucide="arrow-down-circle" className="w-6 h-6"></i></div><span className="text-xs font-bold text-slate-700 mt-1">å……å€¼</span></button><button onClick={()=>setModal({type:'withdraw'})} className="flex-1 flex flex-col items-center gap-1 group"><div className="w-12 h-12 bg-rose-100 text-rose-600 rounded-xl flex items-center justify-center group-active:scale-95 transition-all"><i data-lucide="arrow-up-circle" className="w-6 h-6"></i></div><span className="text-xs font-bold text-slate-700 mt-1">æç°</span></button><button onClick={()=>setModal({type:'invite'})} className="flex-1 flex flex-col items-center gap-1 group"><div className="w-12 h-12 bg-orange-100 text-orange-600 rounded-xl flex items-center justify-center group-active:scale-95 transition-all"><i data-lucide="users" className="w-6 h-6"></i></div><span className="text-xs font-bold text-slate-700 mt-1">é‚€è¯·</span></button><button onClick={()=>setModal({type:'tutorial'})} className="flex-1 flex flex-col items-center gap-1 group"><div className="w-12 h-12 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center group-active:scale-95 transition-all"><i data-lucide="book-open" className="w-6 h-6"></i></div><span className="text-xs font-bold text-slate-700 mt-1">æ•™ç¨‹</span></button></div></div>
                                
                                {/* --- V4.8 åŒæ å¸ƒå±€ --- */}
                                <div className="grid grid-cols-2 gap-3 mb-5">
                                    {/* å·¦ä¾§ï¼šå…¬å‘Šå¿«è®¯ */}
                                    <div className="bg-white rounded-2xl p-3 border border-slate-100 shadow-sm flex flex-col h-32 overflow-hidden relative">
                                        <div className="flex items-center gap-2 mb-2 pb-2 border-b border-slate-50">
                                            <div className="w-5 h-5 bg-orange-100 text-orange-500 rounded-full flex items-center justify-center"><i data-lucide="volume-2" className="w-3 h-3"></i></div>
                                            <span className="text-xs font-bold text-slate-700">å…¬å‘Šå¿«è®¯</span>
                                        </div>
                                        <div className="notice-scroll-box flex-1">
                                            <div className="notice-track space-y-3">
                                                {CONFIG.announcements.map(n => (
                                                    <div key={n.id} onClick={()=>setModal({type:'notice_detail', data:n})} className="text-[10px] text-slate-500 leading-tight truncate cursor-pointer hover:text-orange-500">
                                                        â€¢ {n.title}
                                                    </div>
                                                ))}
                                                {/* é‡å¤ä»¥å®ç°æ— ç¼æ»šåŠ¨ */}
                                                {CONFIG.announcements.map(n => (
                                                    <div key={'dup'+n.id} onClick={()=>setModal({type:'notice_detail', data:n})} className="text-[10px] text-slate-500 leading-tight truncate cursor-pointer hover:text-orange-500">
                                                        â€¢ {n.title}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    {/* å³ä¾§ï¼šç¦åˆ©ä¸­å¿ƒ (åŒ…å«æ–°äººç¤¼ + è½¬ç›˜) */}
                                    <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-3 shadow-lg text-white relative overflow-hidden flex flex-col justify-between h-32">
                                        <div className="relative z-10">
                                            <div className="flex justify-between items-start">
                                                <span className="text-xs font-bold opacity-90">ç¦åˆ©ä¸­å¿ƒ</span>
                                                <span className="bg-white/20 text-[8px] px-1.5 rounded">HOT</span>
                                            </div>
                                            <div className="mt-2">
                                                {/* åŠ¨æ€æ˜¾ç¤ºï¼šå¦‚æœæœªé¢†æ–°äººç¤¼æ˜¾ç¤ºæ–°äººç¤¼ï¼Œå¦åˆ™æ˜¾ç¤ºè½¬ç›˜æœºä¼š */}
                                                {!profile?.bonusClaimed ? (
                                                    <div onClick={handleClaimBonus} className="cursor-pointer">
                                                        <div className="text-lg font-black text-yellow-300">æ–°äººç¤¼</div>
                                                        <div className="text-[9px] opacity-80">é€ 2.88 U</div>
                                                        <div className="mt-1 bg-white text-indigo-600 text-[9px] font-bold px-2 py-0.5 rounded-full w-fit mx-auto shadow-sm animate-pulse">ç‚¹å‡»é¢†å–</div>
                                                    </div>
                                                ) : (
                                                    <div onClick={()=>setModal({type:'spin'})} className="cursor-pointer">
                                                        <div className="text-lg font-black text-yellow-300">å¤§è½¬ç›˜</div>
                                                        <div className="text-[9px] opacity-80">å‰©ä½™æ¬¡æ•°: {availableSpins}</div>
                                                        <div className="mt-1 bg-white text-indigo-600 text-[9px] font-bold px-2 py-0.5 rounded-full w-fit mx-auto shadow-sm">å»æŠ½å¥–</div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                        {/* è£…é¥°èƒŒæ™¯ */}
                                        <i data-lucide={!profile?.bonusClaimed ? "gift" : "dribbble"} className="absolute -right-2 -bottom-3 w-16 h-16 text-white opacity-10 rotate-12 spin-wheel-icon"></i>
                                    </div>
                                </div>

                                {/* --- èµ„è®¯åˆ—è¡¨ (Detail) --- */}
                                <h3 className="font-bold text-slate-800 text-sm mb-3 flex items-center gap-2 px-1"><i data-lucide="file-text" className="w-4 h-4 text-emerald-500"></i> æ›´å¤šèµ„è®¯</h3>
                                <div className="space-y-3 bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                                    {CONFIG.announcements.map((item, i) => (
                                        <div key={item.id} onClick={()=>setModal({type:'notice_detail', data: item})} className="flex justify-between items-center p-4 border-b border-slate-50 last:border-0 active:bg-slate-50 transition-colors cursor-pointer">
                                            <div className="flex items-center gap-2 overflow-hidden">
                                                <div className={`w-6 h-6 rounded-lg flex items-center justify-center shrink-0 ${item.type==='safe'?'bg-red-50 text-red-500':item.type==='edu'?'bg-blue-50 text-blue-500':item.type==='intro'?'bg-emerald-50 text-emerald-500':'bg-slate-100 text-slate-500'}`}><i data-lucide={getNoticeIcon(item.type)} className="w-3 h-3"></i></div>
                                                <span className="text-sm font-medium truncate text-slate-700">{item.title}</span>
                                            </div>
                                            <i data-lucide="chevron-right" className="w-4 h-4 text-slate-300 shrink-0"></i>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Invest, Assets, Profile Tabs (Same as before) */}
                    {tab === 'invest' && (<div className="page-enter flex flex-col h-full safe-top"><div className="px-6 py-4 shrink-0 flex justify-between items-center bg-white border-b border-slate-100"><h2 className="text-2xl font-black text-slate-900">æ¬ç –ä¸­å¿ƒ</h2><div className="flex items-center gap-1 text-[10px] bg-slate-100 px-2 py-1 rounded-full text-slate-500 font-mono"><span className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>LIVE</div></div><div className="flex-1 overflow-y-auto no-scrollbar p-5 pb-40"><MarketCarousel marketData={marketData} /><div className="bg-white p-6 rounded-3xl shadow-lg border border-slate-100"><div className="flex justify-between items-center mb-6"><span className="font-bold text-slate-800 text-sm flex items-center gap-2"><i data-lucide="cpu" className="w-4 h-4"></i> AI ç­–ç•¥é…ç½®</span>{investCurrency === 'USDI' && <span className="text-xs bg-indigo-100 text-indigo-600 px-2 py-1 rounded font-bold">å¹³å°è¡¥è´´ç”Ÿæ•ˆä¸­</span>}</div><div className="flex gap-3 mb-6"><button onClick={() => setInvestCurrency('USDT')} className={`flex-1 py-3.5 rounded-xl font-bold flex flex-col items-center justify-center gap-1 border-2 transition-all ${investCurrency === 'USDT' ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-slate-100 bg-white text-slate-400'}`}><div className="flex items-center gap-2"><i data-lucide="dollar-sign" className="w-4 h-4"></i> USDT æ¬ç –</div></button><button onClick={() => setInvestCurrency('USDI')} className={`flex-1 py-3.5 rounded-xl font-bold flex flex-col items-center justify-center gap-1 border-2 transition-all relative overflow-hidden ${investCurrency === 'USDI' ? 'border-indigo-500 bg-indigo-50 text-indigo-700' : 'border-slate-100 bg-white text-slate-400'}`}><div className="absolute top-0 right-0 bg-red-500 text-white text-[10px] px-1.5 py-0.5 rounded-bl-lg font-bold">è¡¥è´´+0.2%</div><div className="flex items-center gap-2"><i data-lucide="gem" className="w-4 h-4"></i> USDI æ¬ç –</div></button></div><div className="space-y-4"><div><label className="text-xs font-bold text-slate-500 mb-2 block">æŠ•å…¥é‡‘é¢ (ä½™é¢: {fmtMoney(investCurrency === 'USDT' ? balance.usdt : balance.usdi)})</label><div className="relative"><input type="number" id="investAmt" className={`w-full bg-slate-50 border border-slate-200 rounded-xl p-4 text-lg font-bold outline-none transition-colors ${investCurrency==='USDI'?'focus:border-indigo-500':'focus:border-emerald-500'}`} placeholder="100 èµ·æŠ•"/><button className={`absolute right-4 top-4 text-xs font-bold ${investCurrency==='USDI'?'text-indigo-600':'text-emerald-600'}`} onClick={()=>document.getElementById('investAmt').value=(investCurrency === 'USDT' ? balance.usdt : balance.usdi)}>MAX</button></div></div><div className="bg-slate-50 p-4 rounded-xl border border-slate-200"><div className="flex justify-between mb-3"><span className="text-xs font-bold text-slate-500">é”å®šå‘¨æœŸ</span><span className={`font-bold ${investCurrency==='USDI'?'text-indigo-600':'text-emerald-600'}`}>{investDays} å¤©</span></div><input type="range" min="1" max="30" value={investDays} onChange={e=>setInvestDays(Number(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"/><div className="flex justify-between text-[10px] text-slate-400 mt-2"><span>1å¤©</span><span>30å¤©</span></div></div></div><div className="mt-6 bg-slate-50 p-4 rounded-xl space-y-2 border border-slate-100"><div className="flex justify-between text-xs text-slate-500"><span>æ—¥åŒ–æ”¶ç›Šç‡</span><span className={`font-bold ${investCurrency==='USDI'?'text-indigo-600':'text-emerald-600'}`}>{calcUiRate()}%</span></div><div className="flex justify-between text-xs text-slate-500"><span>åˆ°æœŸæ—¶é—´</span><span className="font-bold">--</span></div></div><button onClick={()=>{ const amt = document.getElementById('investAmt').value; if(investCurrency === 'USDI' && Number(amt) > balance.usdi) return toast('USDI ä½™é¢ä¸è¶³', 'error'); if(investCurrency === 'USDT' && Number(amt) > balance.usdt) return toast('USDT ä½™é¢ä¸è¶³', 'error'); handleAction('invest', { amount: amt, days: investDays, currency: investCurrency, title: `${investCurrency} æ¬ç – ${investDays}å¤©` }); }} className={`w-full text-white py-4 rounded-xl font-bold shadow-lg mt-6 active:scale-95 transition-all ${investCurrency === 'USDI' ? 'glow-button-usdi' : 'glow-button'} relative z-10`}>ç«‹å³å¯åŠ¨ ({investCurrency})</button></div></div></div>)}
                    {tab === 'assets' && (<div className="p-5 page-enter safe-top overflow-y-auto h-full pb-24"><h2 className="text-2xl font-black text-slate-900 mt-4 mb-4">èµ„äº§æ˜ç»†</h2><div className="flex gap-2 mb-6 p-1 bg-white rounded-xl border border-slate-200"><button onClick={()=>setAssetFilter('dw')} className={`flex-1 py-3 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-2 ${assetFilter==='dw'?'bg-slate-900 text-white shadow-md':'text-slate-500 hover:bg-slate-50'}`}><i data-lucide="arrow-right-left" className="w-4 h-4"></i> å……å€¼æç°</button><button onClick={()=>setAssetFilter('arb')} className={`flex-1 py-3 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-2 ${assetFilter==='arb'?'bg-slate-900 text-white shadow-md':'text-slate-500 hover:bg-slate-50'}`}><i data-lucide="layers" className="w-4 h-4"></i> æ¬ç –è®°å½•</button></div><div className="space-y-3">{filteredTxs.map(t => (<div key={t.id} onClick={()=>{ setModal({type:'order_detail', data:t}); setConfirmRedeem(false); }} className={`bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex justify-between items-center cursor-pointer active:scale-[0.99] transition-transform`}><div className="flex items-center gap-3"><div className={`w-10 h-10 rounded-full flex items-center justify-center ${t.type==='profit' ? 'bg-amber-100 text-amber-600' : t.type==='deposit' ? 'bg-emerald-100 text-emerald-600' : t.type==='withdraw' ? 'bg-slate-100 text-slate-600' : (t.currency==='USDI' || t.type==='spin_reward') ? 'bg-indigo-100 text-indigo-600' : 'bg-emerald-100 text-emerald-600'}`}><i data-lucide={t.type==='profit'?'trending-up':t.type==='deposit'?'arrow-down':t.type==='withdraw'?'arrow-up':t.type==='spin_reward'?'gift':'zap'} className="w-5 h-5"></i></div><div><div className="font-bold text-sm text-slate-800 flex items-center gap-1">{t.title||t.type}<i data-lucide="chevron-right" className="w-3 h-3 text-slate-300"></i></div><div className="text-[10px] text-slate-400">{fmtDate(t.createdAt)}</div></div></div><div className="text-right"><div className={`font-bold font-mono ${['deposit','profit','spin_reward'].includes(t.type)?'text-emerald-600':'text-slate-900'}`}>{['deposit','profit','spin_reward'].includes(t.type)?'+':'-'}{fmtMoney(t.amount)} <span className="text-[10px] text-slate-400">{t.currency||'U'}</span></div><div className={`text-[10px] px-1.5 py-0.5 rounded inline-block font-bold ${t.status==='success'?'bg-emerald-50 text-emerald-600':t.status==='pending'?'bg-amber-50 text-amber-600':'bg-slate-100 text-slate-500'}`}>{t.status==='pending'?'å®¡æ ¸ä¸­':t.status==='running'?'è¿è¡Œä¸­':t.status==='redeemed'?'å·²èµå›':'å®Œæˆ'}</div></div></div>))}</div></div>)}
                    {tab === 'profile' && (<div className="page-enter bg-slate-100 min-h-screen overflow-y-auto pb-24"><div className="bg-white p-6 pb-8 shadow-sm"><div className="flex items-center gap-4 mt-8"><div className="w-16 h-16 bg-slate-200 rounded-full overflow-hidden border-2 border-white shadow-lg relative group cursor-pointer"><div className="absolute inset-0 bg-black/30 hidden group-hover:flex items-center justify-center text-white text-[10px]">ä¿®æ”¹</div><div className="w-full h-full bg-gradient-to-tr from-indigo-400 to-purple-400 flex items-center justify-center text-white font-bold text-2xl">{profile?.nickname?.[0]||'U'}</div></div><div className="flex-1"><div className="flex items-center gap-2"><h2 className="text-xl font-bold">{profile?.nickname}</h2><i data-lucide="edit-3" className="w-4 h-4 text-slate-400 cursor-pointer" onClick={()=>{const name = prompt("ä¿®æ”¹æ˜µç§°", profile.nickname);if(name) updateProfile({nickname: name});}}></i></div><div className="flex gap-2 mt-1"><span className="text-[10px] bg-slate-900 text-white px-2 py-0.5 rounded font-bold">VIP 1</span><span className="text-[10px] bg-emerald-100 text-emerald-600 px-2 py-0.5 rounded font-bold">å·²è®¤è¯</span></div></div></div></div><div className="p-5 space-y-4 -mt-4"><div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden"><MenuItem icon="wallet" color="text-blue-500" bg="bg-blue-50" label="é’±åŒ…ç®¡ç†" onClick={()=>setModal({type:'wallets'})} /><MenuItem icon="shield-check" color="text-emerald-500" bg="bg-emerald-50" label="å®‰å…¨ä¸­å¿ƒ" onClick={()=>setModal({type:'settings'})} /><MenuItem icon="users" color="text-orange-500" bg="bg-orange-50" label="é‚€è¯·å¥½å‹" onClick={()=>setModal({type:'invite'})} /></div><div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden"><MenuItem icon="book-open" color="text-indigo-500" bg="bg-indigo-50" label="æ–°æ‰‹æ•™ç¨‹" onClick={()=>setModal({type:'tutorial'})} /><MenuItem icon="file-text" color="text-slate-500" bg="bg-slate-50" label="ç”¨æˆ·åè®®" onClick={()=>setModal({type:'agreement'})} /><MenuItem icon="info" color="text-slate-500" bg="bg-slate-50" label="å…³äºæˆ‘ä»¬" onClick={()=>setModal({type:'about'})} /></div><button onClick={()=>auth.signOut()} className="w-full py-4 bg-white text-red-500 font-bold rounded-2xl shadow-sm border border-slate-100">é€€å‡ºç™»å½•</button></div></div>)}
                    
                    <div className="fixed bottom-0 left-0 right-0 mx-auto w-full max-w-md bg-white/95 backdrop-blur-md border-t border-slate-200 flex justify-around p-2 pb-safe z-40 shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
                        <TabBtn id="home" icon="home" label="é¦–é¡µ" />
                        <TabBtn id="invest" icon="zap" label="é‡åŒ–" />
                        <TabBtn id="assets" icon="pie-chart" label="èµ„äº§" />
                        <TabBtn id="profile" icon="user" label="æˆ‘çš„" />
                    </div>

                    {modal && (
                        <div className="fixed inset-0 z-[50] flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4 safe-bottom" onClick={(e)=>e.target===e.currentTarget && setModal(null)}>
                            <div className="bg-white w-full max-w-sm rounded-3xl p-6 page-enter relative overflow-hidden max-h-[80vh] overflow-y-auto no-scrollbar">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="font-bold text-lg">{ 
                                        modal.type==='deposit'?'å……å€¼è¯¦æƒ…': modal.type==='withdraw'?'æç°è¯¦æƒ…': 
                                        modal.type==='invite'?'é‚€è¯·å¥½å‹': modal.type==='wallets'?'é’±åŒ…åœ°å€': 
                                        modal.type==='settings'?'å®‰å…¨è®¾ç½®': modal.type==='tutorial'?'æ–°æ‰‹å¿…è¯»': 
                                        modal.type==='swap'?'USDI é—ªå…‘': modal.type==='order_detail'?'è®¢å•è¯¦æƒ…': 
                                        modal.type==='change_login'?'ä¿®æ”¹ç™»å½•å¯†ç ': modal.type==='change_tx'?'ä¿®æ”¹äº¤æ˜“å¯†ç ': 
                                        modal.type==='about'?'å…³äºæˆ‘ä»¬': modal.type==='notice_detail'?'å…¬å‘Šè¯¦æƒ…': 
                                        modal.type==='spin'?'å¹¸è¿å¤§è½¬ç›˜': 'ç”¨æˆ·åè®®' 
                                    }</h3>
                                    <button onClick={()=>setModal(null)} className="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center"><i data-lucide="x" className="w-4 h-4"></i></button>
                                </div>

                                {modal.type === 'spin' && (
                                    <div className="space-y-6 text-center">
                                        <div className="relative w-48 h-48 mx-auto">
                                            <div className="absolute inset-0 rounded-full border-4 border-indigo-500 border-dashed spin-wheel-icon opacity-20"></div>
                                            <div className="absolute inset-2 rounded-full bg-indigo-50 flex items-center justify-center">
                                                <i data-lucide="gift" className="w-20 h-20 text-indigo-600"></i>
                                            </div>
                                        </div>
                                        <div>
                                            <p className="text-sm text-slate-500">ç´¯è®¡å……å€¼æ¯æ»¡ 1000 U è· 1 æ¬¡æœºä¼š</p>
                                            <div className="text-2xl font-black text-indigo-600 mt-1">å‰©ä½™æ¬¡æ•°: {availableSpins}</div>
                                        </div>
                                        <button onClick={handleSpin} className="w-full py-4 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-bold shadow-lg active:scale-95 transition-transform">
                                            ç«‹å³æŠ½å¥–
                                        </button>
                                    </div>
                                )}
                                
                                {modal.type === 'notice_detail' && (<div className="space-y-4"><h3 className="font-bold text-lg text-slate-900 leading-snug">{modal.data.title}</h3><div className="text-xs text-slate-400 mb-4 flex items-center gap-2"><i data-lucide="clock" className="w-3 h-3"></i> {modal.data.date}</div><div className="text-sm text-slate-600 leading-relaxed whitespace-pre-wrap bg-slate-50 p-4 rounded-xl border border-slate-100">{modal.data.content}</div><button onClick={()=>setModal(null)} className="w-full py-3 bg-slate-900 text-white rounded-xl font-bold text-sm mt-4">æˆ‘çŸ¥é“äº†</button></div>)}
                                {modal.type === 'deposit' && ( <div className="space-y-4"><div className="bg-slate-50 p-4 rounded-xl break-all font-mono text-xs text-center border border-dashed border-slate-300">{CONFIG.adminWallet}<div className="mt-2 text-emerald-600 font-bold cursor-pointer" onClick={()=>toast('å·²å¤åˆ¶','success')}>ç‚¹å‡»å¤åˆ¶åœ°å€</div></div><div><label className="text-xs font-bold text-slate-500 mb-1 block">å……å€¼é‡‘é¢</label><input type="number" id="depAmt" className="w-full bg-slate-50 p-3 rounded-xl border border-slate-200 outline-none font-bold" placeholder="100"/></div><button onClick={()=>handleAction('deposit', {amount:document.getElementById('depAmt').value, title:'å……å€¼'})} className="w-full bg-emerald-500 text-white py-3 rounded-xl font-bold">æäº¤å®¡æ ¸</button></div> )}
                                {modal.type === 'withdraw' && ( <div className="space-y-4"><input type="number" id="wdAmt" className="w-full bg-slate-50 p-3 rounded-xl border border-slate-200 font-bold" placeholder="æç°é‡‘é¢"/><input type="text" className="w-full bg-slate-50 p-3 rounded-xl border border-slate-200 text-sm" placeholder="TRC20 åœ°å€"/><input type="password" className="w-full bg-slate-50 p-3 rounded-xl border border-slate-200" placeholder="äº¤æ˜“å¯†ç "/><button onClick={()=>handleAction('withdraw', {amount:document.getElementById('wdAmt').value, title:'æç°'})} className="w-full bg-slate-900 text-white py-3 rounded-xl font-bold">ç¡®è®¤æç°</button></div> )}
                                {modal.type === 'swap' && ( <div className="space-y-6"><div className="bg-slate-50 p-4 rounded-2xl border text-center mb-2"><p className="text-xs text-slate-500 font-medium">1 USDI = 1.00 USDT (å…æ‰‹ç»­è´¹)</p></div><div className="relative"><div className="bg-white border border-slate-200 rounded-xl p-4 mb-2 shadow-sm"><div className="flex justify-between mb-2"><label className="text-xs text-slate-500 font-bold">ä»</label><span className="text-[10px] text-slate-400 font-bold">ä½™é¢: {fmtMoney(modal.dir==='in'?balance.usdt:balance.usdi)}</span></div><div className="flex justify-between items-center"><input type="number" id="swapAmt" className="text-2xl font-black outline-none w-2/3 placeholder-slate-300" placeholder="0.00" /><div className="flex items-center gap-2 font-bold bg-slate-100 px-3 py-1.5 rounded-lg text-xs text-slate-700"><i data-lucide={modal.dir==='in'?'dollar-sign':'gem'} className="w-3 h-3"></i>{modal.dir==='in'?'USDT':'USDI'}</div></div></div><div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10"><button onClick={()=>{ setModal(m => ({...m, dir: m.dir==='in'?'out':'in'})); }} className="bg-white border border-slate-200 p-2 rounded-full shadow-md hover:bg-slate-50 text-indigo-500 transition-transform active:rotate-180"><i data-lucide="arrow-down-up" className="w-5 h-5"></i></button></div><div className="bg-slate-50 border border-slate-200 rounded-xl p-4 mt-2"><div className="flex justify-between mb-2"><label className="text-xs text-slate-500 font-bold">åˆ°</label><span className="text-[10px] text-slate-400 font-bold">ä½™é¢: {fmtMoney(modal.dir==='in'?balance.usdi:balance.usdt)}</span></div><div className="flex justify-between items-center"><div className="text-2xl font-black text-slate-400">â‰ˆ 0.00</div><div className="flex items-center gap-2 font-bold bg-white border px-3 py-1.5 rounded-lg text-xs text-slate-700"><i data-lucide={modal.dir==='in'?'gem':'dollar-sign'} className="w-3 h-3"></i>{modal.dir==='in'?'USDI':'USDT'}</div></div></div></div><button onClick={()=>{ const amt = document.getElementById('swapAmt').value; if(!amt || Number(amt)<=0) return toast('è¯·è¾“å…¥å…‘æ¢é‡‘é¢', 'error'); const isToUsdi = modal.dir === 'in'; const bal = isToUsdi ? balance.usdt : balance.usdi; if(Number(amt) > bal) return toast(`${isToUsdi?'USDT':'USDI'} ä½™é¢ä¸è¶³`, 'error'); handleAction(isToUsdi ? 'swap_usdt_to_usdi' : 'swap_usdi_to_usdt', { amount: amt, currency: 'USDI', title: isToUsdi ? 'USDT å…‘æ¢ USDI' : 'USDI å…‘æ¢ USDT' }); }} className="w-full bg-gradient-to-r from-violet-600 to-indigo-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-indigo-500/20 active:scale-95 transition-all">ç¡®è®¤å…‘æ¢</button></div> )}
                                {modal.type === 'order_detail' && (() => { const { data } = modal; if(['deposit', 'withdraw', 'spin_reward'].includes(data.type)) return ( <div className="space-y-6 text-center"><div className={`w-16 h-16 mx-auto rounded-full flex items-center justify-center ${data.type==='deposit'?'bg-emerald-100 text-emerald-600':'bg-rose-100 text-rose-600'}`}><i data-lucide={data.type==='deposit'?'arrow-down':'arrow-up'} className="w-8 h-8"></i></div><div><div className="text-3xl font-black">{data.type==='deposit'?'+':'-'}{fmtMoney(data.amount)}</div><div className="text-sm text-slate-400 mt-1">{data.status==='success'?'äº¤æ˜“æˆåŠŸ':data.status==='pending'?'å®¡æ ¸ä¸­':'äº¤æ˜“å¤±è´¥'}</div></div><div className="bg-slate-50 p-4 rounded-xl text-left space-y-3 text-sm"><div className="flex justify-between"><span className="text-slate-500">äº¤æ˜“æ—¶é—´</span><span>{fmtDate(data.createdAt)}</span></div><div className="flex justify-between"><span className="text-slate-500">äº¤æ˜“å•å·</span><span className="font-mono text-xs">{data.id.slice(0,12)}...</span></div></div></div> ); const start = data.createdAt ? new Date(data.createdAt.seconds*1000) : new Date(); const end = new Date(start.getTime() + (data.days||1)*24*3600*1000); const now = new Date(); const isRunning = data.status === 'running'; const isEarly = now < end; const progress = isRunning ? Math.min(100, Math.max(0, ((now - start) / (end - start)) * 100)) : 100; const expectedProfit = (data.amount * (0.008 + (data.currency==='USDI'?0.002:0)) * data.days).toFixed(2); const penalty = data.amount * 0.02; const returnAmount = data.amount - penalty; if(confirmRedeem) return ( <div className="space-y-6 animate-in slide-in-from-right"><div className="text-center py-4"><div className="w-16 h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4"><i data-lucide="alert-triangle" className="w-8 h-8"></i></div><h3 className="font-bold text-lg text-slate-900">ç¡®è®¤èµå›ï¼Ÿ</h3><p className="text-sm text-slate-500 mt-2 px-4">å½“å‰è®¢å•å°šæœªåˆ°æœŸã€‚æå‰èµå›å°†æ‰£é™¤è¿çº¦é‡‘ï¼Œè¯·ä»”ç»†ç¡®è®¤ã€‚</p></div><div className="bg-slate-50 p-4 rounded-2xl space-y-3 text-sm"><div className="flex justify-between"><span className="text-slate-500">æœ¬é‡‘é€€å›</span><span className="font-bold">{fmtMoney(data.amount)}</span></div><div className="flex justify-between text-red-500"><span className="font-bold">è¿çº¦é‡‘ (2%)</span><span className="font-bold">-{fmtMoney(penalty)}</span></div><div className="border-t border-slate-200 pt-3 flex justify-between items-center"><span className="text-slate-900 font-bold">å®é™…åˆ°è´¦</span><span className="text-xl font-black text-emerald-600">{fmtMoney(returnAmount)}</span></div></div><div className="flex gap-3"><button onClick={()=>setConfirmRedeem(false)} className="flex-1 py-3.5 bg-white border border-slate-200 text-slate-500 rounded-xl font-bold">å†æƒ³æƒ³</button><button onClick={()=>handleRedeem(data)} className="flex-[2] py-3.5 bg-red-500 text-white rounded-xl font-bold shadow-lg shadow-red-500/30 active:scale-95 transition-all">ç¡®è®¤èµå›</button></div></div> ); return ( <div className="space-y-6">{isRunning && ( <div className="scan-card bg-slate-900 text-emerald-400 p-4 rounded-xl mb-4 text-center font-mono text-xs relative"><div className="scan-line absolute top-0 left-0"></div><div className="flex justify-center items-center gap-2 mb-2"><i data-lucide="activity" className="w-4 h-4 animate-pulse"></i><span>AI æ­£åœ¨å…¨ç½‘å¥—åˆ©ä¸­...</span></div><div className="grid grid-cols-3 gap-2 opacity-80"><div>Uniswap<br/><span className="text-white">+0.4%</span></div><div>Curve<br/><span className="text-white">+0.2%</span></div><div>Sushi<br/><span className="text-white">+0.3%</span></div></div></div> )}<div className="grid grid-cols-2 gap-3 mb-4"><div className="text-center p-3 bg-slate-50 rounded-xl border border-slate-200"><div className="text-xs text-slate-400 mb-1">æŠ•å…¥æœ¬é‡‘</div><div className="text-lg font-black text-slate-900">{fmtMoney(data.amount)}</div></div><LiveOrderProfit order={data} /></div><div className="bg-slate-50 p-4 rounded-xl border border-slate-200"><div className="flex justify-between text-sm mb-3"><span className="text-slate-500">è¿è¡Œå‘¨æœŸ</span><span className="font-bold">{data.days} å¤©</span></div><div className="flex justify-between text-sm mb-3"><span className="text-slate-500">é¢„è®¡æ”¶ç›Š</span><span className="font-bold text-emerald-600">+{expectedProfit} {data.currency}</span></div><div className="flex justify-between text-xs text-slate-400 mt-4 border-t border-slate-200 pt-3"><span>å¼€å§‹: {start.toLocaleDateString()}</span><span>ç»“æŸ: {end.toLocaleDateString()}</span></div>{isRunning && ( <div className="mt-3 h-2 bg-slate-200 rounded-full overflow-hidden"><div className="h-full bg-emerald-500 transition-all duration-1000" style={{width: `${progress}%`}}></div></div> )}</div>{isRunning && ( <button onClick={()=>{ if(isEarly) setConfirmRedeem(true); else handleRedeem(data); }} className={`w-full py-3.5 rounded-xl font-bold text-white shadow-lg active:scale-95 transition-all ${isEarly ? 'glow-button-red' : 'glow-button'}`}>{isEarly ? 'æå‰èµå›' : 'åˆ°æœŸèµå›'}</button> )}</div> ); })()}
                                {modal.type === 'invite' && ( <div className="text-center space-y-4"><div className="bg-gradient-to-r from-purple-600 to-blue-600 p-6 rounded-2xl text-white text-center shadow-lg"><div className="text-sm opacity-80">æ‚¨çš„ä¸“å±é‚€è¯·ç </div><div className="text-3xl font-black tracking-widest my-2">{user.uid.slice(0,6).toUpperCase()}</div><button onClick={copyInviteLink} className="bg-white text-indigo-600 px-4 py-1.5 rounded-full font-bold text-xs shadow-sm inline-flex items-center gap-2 active:scale-95 transition-transform"><i data-lucide="copy" className="w-3 h-3"></i> å¤åˆ¶æ¨å¹¿é“¾æ¥</button></div><div className="flex justify-between text-sm px-2 py-2 bg-slate-50 rounded-xl border border-slate-100"><div className="text-center flex-1 border-r border-slate-200 last:border-0"><div className="font-bold text-lg text-slate-900">0</div><div className="text-xs text-slate-400">ç›´æ¨äººæ•°</div></div><div className="text-center flex-1 border-r border-slate-200 last:border-0"><div className="font-bold text-lg text-slate-900">0</div><div className="text-xs text-slate-400">å›¢é˜Ÿæ€»æ•°</div></div><div className="text-center flex-1"><div className="font-bold text-lg text-emerald-500">0.00</div><div className="text-xs text-slate-400">ç´¯è®¡ä½£é‡‘</div></div></div><div className="bg-white border border-slate-200 rounded-xl p-4 shadow-sm"><h4 className="font-bold text-sm text-slate-800 mb-4 flex items-center gap-2"><i data-lucide="git-merge" className="w-4 h-4 text-indigo-500"></i> ä¸‰çº§åˆä¼™äººæœºåˆ¶</h4><div className="space-y-4 relative"><div className="absolute left-3.5 top-3 bottom-3 w-0.5 bg-slate-100"></div><div className="flex items-center gap-4 relative z-10"><div className="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold text-xs border-2 border-white shadow-sm">L1</div><div className="flex-1"><div className="flex justify-between"><span className="text-sm font-bold text-slate-700">ä¸€çº§é‚€è¯· (ç›´æ¨)</span><span className="font-black text-indigo-600">0.3%</span></div><div className="w-full bg-slate-100 h-1.5 rounded-full mt-1.5 overflow-hidden"><div className="h-full bg-indigo-500 w-3/4 rounded-full"></div></div></div></div><div className="flex items-center gap-4 relative z-10"><div className="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs border-2 border-white shadow-sm">L2</div><div className="flex-1"><div className="flex justify-between"><span className="text-sm font-bold text-slate-700">äºŒçº§é‚€è¯· (é—´æ¨)</span><span className="font-black text-blue-600">0.2%</span></div><div className="w-full bg-slate-100 h-1.5 rounded-full mt-1.5 overflow-hidden"><div className="h-full bg-blue-500 w-1/2 rounded-full"></div></div></div></div><div className="flex items-center gap-4 relative z-10"><div className="w-8 h-8 rounded-full bg-cyan-100 text-cyan-600 flex items-center justify-center font-bold text-xs border-2 border-white shadow-sm">L3</div><div className="flex-1"><div className="flex justify-between"><span className="text-sm font-bold text-slate-700">ä¸‰çº§é‚€è¯· (è£‚å˜)</span><span className="font-black text-cyan-600">0.1%</span></div><div className="w-full bg-slate-100 h-1.5 rounded-full mt-1.5 overflow-hidden"><div className="h-full bg-cyan-500 w-1/4 rounded-full"></div></div></div></div></div></div></div> )}
                                {modal.type === 'wallets' && ( <div className="space-y-4"><div className="text-center text-slate-400 text-sm py-8 bg-slate-50 rounded-xl border border-dashed">æš‚æ— ç»‘å®šçš„é’±åŒ…åœ°å€</div><button className="w-full border-2 border-slate-900 text-slate-900 py-3 rounded-xl font-bold">+ æ·»åŠ æ–°åœ°å€</button></div> )}
                                {modal.type === 'settings' && ( <div className="space-y-4"><div className="flex justify-between items-center p-3 bg-slate-50 rounded-xl"><span className="text-sm font-bold">ç™»å½•å¯†ç </span><span className="text-xs text-emerald-600 font-bold">ä¿®æ”¹</span></div><div className="flex justify-between items-center p-3 bg-slate-50 rounded-xl"><span className="text-sm font-bold">äº¤æ˜“å¯†ç </span><span className="text-xs text-red-500 font-bold">æœªè®¾ç½®</span></div></div> )}
                                {modal.type === 'change_login' && (<div className="space-y-4"><div className="bg-yellow-50 text-yellow-700 text-xs p-3 rounded-lg">ä¸ºäº†æ‚¨çš„è´¦æˆ·å®‰å…¨ï¼Œä¿®æ”¹å¯†ç åéœ€è¦é‡æ–°ç™»å½•ã€‚</div><div><label className="text-xs font-bold text-slate-500 mb-1 block">æ–°ç™»å½•å¯†ç </label><input type="password" id="newLoginPwd" className="w-full bg-slate-50 p-3 rounded-xl border border-slate-200 outline-none" placeholder="è‡³å°‘6ä½å­—ç¬¦"/></div><button onClick={()=>handleChangePwd('login', document.getElementById('newLoginPwd').value)} className="w-full bg-slate-900 text-white py-3 rounded-xl font-bold">ç¡®è®¤ä¿®æ”¹</button></div>)}
                                {modal.type === 'change_tx' && (<div className="space-y-4"><div className="bg-blue-50 text-blue-700 text-xs p-3 rounded-lg">äº¤æ˜“å¯†ç ç”¨äºæç°å’Œå®‰å…¨éªŒè¯ï¼Œè¯·è®¾ç½®6ä½çº¯æ•°å­—ã€‚</div><div><label className="text-xs font-bold text-slate-500 mb-1 block">æ–°äº¤æ˜“å¯†ç </label><input type="password" id="newTxPwd" maxlength="6" className="w-full bg-slate-50 p-3 rounded-xl border border-slate-200 outline-none text-center text-lg tracking-widest" placeholder="â—â—â—â—â—â—"/></div><button onClick={()=>handleChangePwd('tx', document.getElementById('newTxPwd').value)} className="w-full bg-emerald-500 text-white py-3 rounded-xl font-bold">ä¿å­˜è®¾ç½®</button></div>)}
                                {modal.type === 'tutorial' && ( <div className="space-y-4 h-64 overflow-y-auto pr-2 text-sm text-slate-600"><p>1. æ³¨å†Œè´¦å·å¹¶ç™»å½•ã€‚</p><p>2. åœ¨â€œé¦–é¡µâ€ç‚¹å‡»â€œå……å€¼â€ï¼Œè½¬å…¥ USDTã€‚</p><p>3. è¿›å…¥â€œé‡åŒ–â€é¡µé¢ï¼Œé€‰æ‹©æŠ•å…¥é‡‘é¢å’Œå‘¨æœŸã€‚</p><p>4. å¯åŠ¨å AI å°†è‡ªåŠ¨è¿›è¡Œä½ä¹°é«˜å–ã€‚</p><p>5. åˆ°æœŸåæœ¬é‡‘å’Œæ”¶ç›Šè‡ªåŠ¨è¿”å›ä½™é¢ã€‚</p></div> )}
                                {modal.type === 'agreement' && (<div className="h-full overflow-y-auto text-sm text-slate-600 space-y-4 p-2 leading-relaxed"><p className="font-bold text-slate-900">1. æœåŠ¡æ¡æ¬¾ç¡®è®¤</p><p>æ¬¢è¿ä½¿ç”¨ USDT æ™ºèƒ½æ¬ç –ç³»ç»Ÿï¼ˆä»¥ä¸‹ç®€ç§°â€œæœ¬å¹³å°â€ï¼‰ã€‚åœ¨ä½¿ç”¨æœ¬å¹³å°æä¾›çš„ AI é‡åŒ–ä¸æ™ºèƒ½åˆçº¦æœåŠ¡å‰ï¼Œè¯·æ‚¨åŠ¡å¿…ä»”ç»†é˜…è¯»å¹¶é€å½»ç†è§£æœ¬ã€Šç”¨æˆ·æœåŠ¡åè®®ã€‹ã€‚ä¸€æ—¦æ‚¨æ³¨å†Œæˆ–ä½¿ç”¨æœ¬å¹³å°æœåŠ¡ï¼Œå³è§†ä¸ºæ‚¨å·²å®Œå…¨åŒæ„å¹¶æ¥å—æœ¬åè®®æ‰€æœ‰æ¡æ¬¾ã€‚</p><p className="font-bold text-slate-900">2. æ ¸å¿ƒæŠ€æœ¯ä¸æœåŠ¡</p><p>æœ¬å¹³å°åŸºäº Web3.0 æ¶æ„ï¼Œåˆ©ç”¨åˆ†å¸ƒå¼èŠ‚ç‚¹ä¸ AI ç®—æ³•ï¼Œè‡ªåŠ¨æ‰«æå…¨çƒå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆDEXï¼‰ä¸ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆCEXï¼‰ä¹‹é—´çš„æµåŠ¨æ€§ä»·å·®ã€‚é€šè¿‡éƒ¨ç½²åœ¨ä»¥å¤ªåŠã€BSCã€Tron ç­‰å…¬é“¾ä¸Šçš„åŸå­æ™ºèƒ½åˆçº¦ï¼Œå®ç°æ¯«ç§’çº§çš„é«˜é¢‘è‡ªåŠ¨åŒ–æ¬ç –å¥—åˆ©ã€‚</p><p className="font-bold text-slate-900">3. æ”¶ç›Šä¸é£é™©å£°æ˜</p><p>å°½ç®¡â€œæ¬ç –å¥—åˆ©â€åœ¨ç†è®ºä¸Šå±äºä½é£é™©äº¤æ˜“æ¨¡å‹ï¼Œä½†åŠ å¯†è´§å¸å¸‚åœºæœ¬èº«å…·æœ‰é«˜æ³¢åŠ¨æ€§ã€‚å¹³å°å±•ç¤ºçš„ APYï¼ˆå¹´åŒ–æ”¶ç›Šç‡ï¼‰åŸºäºå†å²æ•°æ®å›æµ‹åŠå®æ—¶å¸‚åœºæ·±åº¦ä¼°ç®—ï¼Œä¸ä»£è¡¨å¯¹æœªæ¥æ”¶ç›Šçš„ç»å¯¹æ‰¿è¯ºã€‚ç”¨æˆ·åº”æ ¹æ®è‡ªèº«é£é™©æ‰¿å—èƒ½åŠ›ç†æ€§æŠ•èµ„ã€‚</p><p className="font-bold text-slate-900">4. åˆè§„ä¸åæ´—é’± (AML)</p><p>å¹³å°ä¸¥æ ¼éµå®ˆå›½é™…åæ´—é’±æ³•è§„ã€‚ä¸¥ç¦åˆ©ç”¨æœ¬å¹³å°è¿›è¡Œæ´—é’±ã€ææ€–èèµ„æˆ–å…¶ä»–éæ³•æ´»åŠ¨ã€‚å¯¹äºè§¦å‘é£æ§ç³»ç»Ÿçš„å¼‚å¸¸èµ„é‡‘æµå‘ï¼Œå¹³å°æœ‰æƒé‡‡å–å†»ç»“è´¦æˆ·ã€ä¸ŠæŠ¥ç›‘ç®¡æœºæ„ç­‰æªæ–½ã€‚</p><p className="font-bold text-slate-900">5. ä¸å¯æŠ—åŠ›</p><p>å› åŒºå—é“¾ç½‘ç»œæ‹¥å µã€æ™ºèƒ½åˆçº¦åº•å±‚æ¼æ´ã€é»‘å®¢æ”»å‡»æˆ–æ”¿ç­–æ³•è§„å˜æ›´ç­‰ä¸å¯æŠ—åŠ›å› ç´ å¯¼è‡´çš„æŸå¤±ï¼Œå¹³å°å°†å°½æœ€å¤§åŠªåŠ›ååŠ©æŒ½å›ï¼Œä½†ä¸æ‰¿æ‹…è¿å¸¦èµ”å¿è´£ä»»ã€‚</p></div>)}
                                {modal.type === 'about' && (<div className="space-y-6 text-center"><div className="w-20 h-20 bg-slate-900 rounded-3xl flex items-center justify-center mx-auto shadow-xl shadow-slate-900/20"><i data-lucide="cpu" className="w-10 h-10 text-emerald-400"></i></div><div><h2 className="text-xl font-black text-slate-900">USDT æ™ºèƒ½æ¬ç –ç³»ç»Ÿ</h2><p className="text-xs text-slate-400 font-mono mt-1">Version 4.8.0 Enterprise</p></div><div className="text-left text-sm text-slate-600 leading-relaxed bg-slate-50 p-4 rounded-xl border border-slate-100"><p className="mb-3"><span className="font-bold text-slate-800">USDT é‡åŒ–å¤§å¸ˆ</span> æ˜¯ä¸€å®¶ä¸“æ³¨äºåŒºå—é“¾é‡‘èç§‘æŠ€çš„å…ˆé©±ä¼ä¸šã€‚æˆ‘ä»¬æ‹¥æœ‰ä¸€æ”¯ç”±åå°”è¡—é‡åŒ–äº¤æ˜“å‘˜ã€å¯†ç å­¦ä¸“å®¶åŠ AI ç®—æ³•å·¥ç¨‹å¸ˆç»„æˆçš„é¡¶å°–å›¢é˜Ÿã€‚</p><p>æˆ‘ä»¬çš„æ ¸å¿ƒç«äº‰åŠ›åœ¨äºè‡ªç ”çš„ <span className="text-indigo-600 font-bold">"Deep-Arb" æ·±åº¦å¥—åˆ©å¼•æ“</span>ã€‚è¯¥å¼•æ“ç›´æ¥ä¸é“¾ä¸ŠèŠ‚ç‚¹äº¤äº’ï¼Œç»•è¿‡ä¼ ç»Ÿå‰ç«¯å»¶è¿Ÿï¼Œèƒ½å¤Ÿåœ¨åŒä¸€åŒºå—å†…å®Œæˆå‘ç°ä»·å·®ã€å€Ÿè´·é—ªç”µè´·ã€æ‰§è¡Œäº¤æ˜“ã€è¿˜æ¬¾å¹¶é”å®šåˆ©æ¶¦çš„å…¨è¿‡ç¨‹ã€‚</p><div className="mt-4 grid grid-cols-3 gap-2 text-center"><div className="bg-white p-2 rounded-lg shadow-sm border border-slate-100"><div className="text-emerald-500 font-black">99.9%</div><div className="text-[9px] text-slate-400">ç³»ç»Ÿåœ¨çº¿ç‡</div></div><div className="bg-white p-2 rounded-lg shadow-sm border border-slate-100"><div className="text-indigo-500 font-black">50ms</div><div className="text-[9px] text-slate-400">æé€Ÿå“åº”</div></div><div className="bg-white p-2 rounded-lg shadow-sm border border-slate-100"><div className="text-orange-500 font-black">0 é£é™©</div><div className="text-[9px] text-slate-400">æ™ºèƒ½åˆçº¦ä¿éšœ</div></div></div></div><button onClick={()=>window.open('https://ethereum.org', '_blank')} className="w-full py-3 rounded-xl bg-slate-900 text-white font-bold text-sm">è®¿é—®å®˜ç½‘</button></div>)}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const MenuItem = ({ icon, color, bg, label, onClick }) => (<div onClick={onClick} className="flex items-center justify-between p-4 border-b border-slate-50 last:border-0 active:bg-slate-50 cursor-pointer"><div className="flex items-center gap-4"><div className={`w-10 h-10 ${bg} ${color} rounded-xl flex items-center justify-center`}><i data-lucide={icon} className="w-5 h-5"></i></div><span className="font-bold text-sm text-slate-700">{label}</span></div><i data-lucide="chevron-right" className="w-4 h-4 text-slate-300"></i></div>);

        const App = () => {
            const { user, loading, profile } = useAuth();
            useEffect(() => lucide.createIcons());
            if(loading) return <div className="h-screen flex items-center justify-center"><div className="spinner"></div></div>;
            return <ToastProvider>{!user ? <Login /> : <Dashboard user={user} profile={profile} />}</ToastProvider>;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
